<!DOCTYPE html>
<html lang="en">
<head>

    <link rel="stylesheet" type="text/css" href="./css/materialize.css" media="screen,projection"/>

    <script src="./lib/touch-emulator.js"></script>
    <script src="./lib/matter.js"></script>
    <script src="./lib/d3.v4.js"></script>
    <script src="./lib/jquery-3.1.1.js"></script>
    <script src="./lib/hammer-2.0.8.js"></script>

    <script src="./js/SimplePromise.js"></script>
    <script src="./js/matterD3Renderer.js"></script>

    <script src="./js/boot.js"></script>
    <script src="./js/effects.js"></script>
    <script src="./js/body.js"></script>
    <script src="./js/nobody.js"></script>
    <script src="./js/events.js"></script>
    <script src="./js/init.js"></script>

    <meta charset="UTF-8">
    <title>Hacker Run</title>

    <style>
        text {
            font-size: 5em;
        }
    </style>

</head>
<body>

<svg id="field"></svg>

<script>
    WORLD.init();

    WORLD.onTouchMove(function (x, y) {
        var id = WORLD.rectangleBody(x, y, 8, 8, true);
        setTimeout(function () {
            WORLD.removeBodyWithId(id)
        }, 10000);
    });

    for (var ctr = 0; ctr < 10; ctr++) {
        var randomX = Math.random() * WORLD.width;
        var randomY = Math.random() * WORLD.height / 2 + WORLD.height / 2;
        var randomLength = Math.random() * 30 + 20;

        var rectid = WORLD.rectangleBody(randomX, randomY, randomLength, 10, true, "blue");
        var rotesDingId = WORLD.rectangleBody(randomX, randomY, randomLength, 10, true, "red");
        var grauerBalkenId = WORLD.rectangleBody(0, WORLD.height - 5, WORLD.width, 5, true, "lightgrey");
        var rectid4 = function () {
            var randomX
        };

        WORLD.onCollisionStart(rotesDingId, function (pair) {
            function removeIfCircle(body) {
                if (body.label.startsWith("Circle")) {
                    WORLD.removeBody(body);
                    nextCircle();
                }
            }

            WORLD.onCollisionStart(rectid, function () {
                WORLD.backgroundColorFlash("yellow");
                WORLD.showSplash("+1", "hit");
            });


            WORLD.backgroundColorFlash("red");
            WORLD.showSplash("-1");
            removeIfCircle(pair.bodyA);
            removeIfCircle(pair.bodyB);
        });
    }

    function nextCircle() {
        var randomX = Math.random() * WORLD.width;
        var kugelId = WORLD.circleBody(randomX, -20, 10, false, "pink");

        WORLD.onCollisionStart(grauerBalkenId, function () {
            WORLD.backgroundColorFlash("red");
            WORLD.showSplash("-1", "hit");
            WORLD.removeBodyWithId(kugelId);
            nextCircle();
        });

        setInterval(function () {
            if(WORLD.removeBodyIfOutOfScreen(kugelId)) {
                nextCircle();
            }
        }, 100);
    }

    nextCircle();

    function moveToLeft() {
        WORLD.moveBody(rectid, 10, 10, 20).then(moveToRight);
    }

    function moveToRight() {
        WORLD.moveBody(rectid, 10, 900, 600, WORLD.width).then(moveToLeft);
    }

    moveToLeft();

    WORLD.rectangle(0, WORLD.height - 5, WORLD.width, 5, "lightgrey");


</script>

</body>
</html>