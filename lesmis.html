<!DOCTYPE html>
<html lang="en">
<head>

    <link rel="stylesheet" type="text/css" href="./css/materialize.css" media="screen,projection"/>
    <link rel="stylesheet" type="text/css" href="./css/material-icons.css"/>

    <script src="./lib/touch-emulator.js"></script>
    <script src="./lib/matter.js"></script>
    <script src="./lib/d3.v4.js"></script>
    <script src="./lib/jquery-3.1.1.js"></script>
    <script src="./lib/hammer-2.0.8.js"></script>
    <script src="./lib/lodash.js"></script>


    <meta charset="UTF-8">
    <title>Just a cool game</title>

    <style>
        text {
            font-size: 5em;
            color: black;
        }

        text.dynamic {
            font-size: 0.5em;
        }

        path.dynamic {
            opacity: .5;
        }

        line.constraint {
            stroke: black;
            opacity: .3;
        }

    </style>

</head>
<body>

<svg id="field"></svg>

<script src="res/lesmis.js"></script>

<script>

    /* global _ */
    /* global World */

    var FORCE = 0.001;

    var world = new World();

    world.setYGravity(0);
    world.setXGravity(0);

    function createBall(x, y, title) {
        var ball = world.circleBody(x, y, 5, false, "blue", undefined, undefined, {
            collisionFilterGroup: -1,
            title: title
        });
        ball.restitution = 0.9;

        return ball;
    }

    var NUMBER_OF_BALLS_PER_ROW = 10;
    var NUMBER_OF_BALLS_PER_COL = 10;
    var NUMBER_OF_BALLS = NUMBER_OF_BALLS_PER_ROW * NUMBER_OF_BALLS_PER_COL;

    var balls = [];

    function x(i) {
        return ((i % NUMBER_OF_BALLS_PER_ROW) + 1) * (1000 / NUMBER_OF_BALLS_PER_ROW);
    }

    function y(i) {
        return (Math.floor(i / NUMBER_OF_BALLS_PER_COL) + 1) * (800 / NUMBER_OF_BALLS_PER_COL);
    }


    var i;
    lesmis.nodes.forEach(function (node, i) {
        balls.push(createBall(x(i), y(i), node.id));
    });

    function findIndex(id) {
        return lesmis.nodes.findIndex(function (node) {
            return node.id == id;
        })
    }

    lesmis.links.forEach(function (link) {
        var sourceIndex = findIndex(link.source);
        var targetIndex = findIndex(link.target);
        world.connect2Bodies(balls[sourceIndex], balls[targetIndex], 300 / link.value, 0.001 / link.value);
    });

    world.onClick(function () {
        world.stop();
    });

</script>

</body>
</html>